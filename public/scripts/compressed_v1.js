!function(){function b(a,b,c,d,e){var f=this,g="";for(var h of c)g+=h+"/";f.getNumOfPara=function(){return e},f.getPath=function(){var a="";for(var b of c)a+=b.replace(/_/g," ")+" > ";return a.slice(0,a.length-2)},f.getTitle=function(){return c[c.length-1].replace(/_/g," ")},f.theNumberOfEachTranslations=function(){for(var a=[],b=0;b<e;b++)a.push(10);return a},f.getLink=function(){var b=firebase.database().ref().child(g+"link");return a(b)},f.getDateModified=function(){var b=firebase.database().ref().child(g+"dateModified");return a(b)},f.getBannedUsers=function(){var b=firebase.database().ref("bannedUsers");return a(b)},f.getParagraphs=function(){var a=firebase.database().ref().child(g+"paragraphs");return b(a)},f.getUsers=function(){var b=firebase.database().ref().child("users");return a(b)},f.getArrayofTranslations=function(){for(var c,f,a=[],h=1;h<1+e;h++)h<10?(c=firebase.database().ref().child(g+"paragraphs/paragraph0"+h+"/"+d),f=c.orderByChild("timestamp").limitToLast(10),a.push(b(f))):(c=firebase.database().ref().child(g+"paragraphs/paragraph"+h+"/"+d),f=c.orderByChild("timestamp").limitToLast(10),a.push(b(f)));return a}}function c(a,b,c,f,g){var h=this;const i=9,j="0E7culXypcRT3MBc9syiqXdW5RJ2",k="korean",l=10;h.auth=f(),h.adminId=j,h.auth.$onAuthStateChanged(function(a){h.firebaseUser=a,a?h.user=a.displayName:h.user="Guest "+Math.round(100*Math.random())});var m=a.slice(0,a.length-1);h.mainService=g(m,k,a[a.length-1]),d(h,h.mainService),e(h,h.mainService),h.addTranslation=function(a,c){if(h.content[c])if(h.firebaseUser){var d=parseInt((new Date).yyyymmdd());h.updateDailyCount(d,h.content[c]),h.users[h.firebaseUser.uid].count>=0?h.userIpaddress?(h.userIpaddress=h.userIpaddress.replace(/\./g,""),h.bannedUsers[h.userIpaddress]||h.bannedUsers[h.firebaseUser.uid]||(a.$add({user:h.user,userIpaddress:h.userIpaddress,faultyCount:0,userUid:h.firebaseUser.uid,content:h.content[c].replace(/ /g,"&nbsp").replace(/\n/g,"<br>"),timestamp:firebase.database.ServerValue.TIMESTAMP}),h.content[c]="")):h.bannedUsers[h.firebaseUser.uid]||(a.$add({user:h.user,userIpaddress:"stupid ipfinder is not working",faultyCount:0,userUid:h.firebaseUser.uid,content:h.content[c].replace(/ /g,"&nbsp").replace(/\n/g,"<br>"),timestamp:firebase.database.ServerValue.TIMESTAMP}),h.content[c]=""):b.alert("Sorry! you can only translate 10 times a day for protection")}else b.alert("You need to log in!");else b.alert("you ain't write anything")},h.updateDailyCount=function(a,b){var c=h.firebaseUser.uid,d=h.users;d[c]||(d[c]={count:l,recentDate:a,contribution:10,content:[b]},h.firebaseUser.email&&(d[c].email=h.firebaseUser.email),h.userIpaddress&&(d[c].ipaddress=h.userIpaddress.replace(/\./g,""))),d[c].recentDate!=a&&(d[c].recentDate=a,d[c].count=l),d[c].contribution+=10,d[c].count--,d[c].content.push(b),d.$save()},h.createUserIpaddress=function(){if(h.firebaseUser){parseInt((new Date).yyyymmdd());h.users[h.firebaseUser.uid]&&h.users[h.firebaseUser.uid].count<=0&&b.alert("Sorry! you can only translate 10 times a day for protection")}else b.alert("you need to log in to save your translation");c.get("https://freegeoip.net/json/?callback=").then(function(a){h.userIpaddress=a.data.ip}).catch(function(a){console.log("geoplugin is not working",a.message)})},h.claimFaultyTranslation=function(a,c,d){if(h.firebaseUser){if(c.faultyTranslation&&c.faultyTranslation[d]?(c.faultyCount--,c.faultyTranslation[d]=null):(c.faultyCount++,c.faultyTranslation||(c.faultyTranslation={}),c.faultyTranslation[d]=!0),c.faultyCount>i){var e=c.userIpaddress.replace(/\./g,"");"stupid ipfinder is not working"!=e&&(h.bannedUsers[e]=!0),h.bannedUsers[c.userUid]=!0,h.bannedUsers.$save()}a.$save(c)}else b.alert("please log in first!")},h.convertTimestamp=function(a){var b=new Date(a);return b.toString().slice(4,21)},h.alert=function(a){b.alert(a)},h.reload=function(){b.location.reload()},h.banTranslation=function(a,b){if(h.firebaseUser&&h.firebaseUser.uid==h.adminId){var c=b.userIpaddress.replace(/\./g,"");"stupid ipfinder is not working"!=c&&(h.bannedUsers[c]=!0),h.bannedUsers[b.userUid]=!0,console.log("this user is in trouble",b.userUid),h.bannedUsers.$save(),a.$save(b)}},h.removeTranslation=function(a,b){h.firebaseUser&&h.firebaseUser.uid==h.adminId&&a.$remove(b)}}function d(a,b){b.getParagraphs().$loaded(function(b){a.paragraphs=b,a.numOfParagraphs=b.length}),a.ArrayOfTranslations=b.getArrayofTranslations(),a.link=b.getLink(),a.dateModified=b.getDateModified(),a.theNumberOfEachTranslations=b.theNumberOfEachTranslations(),a.path=b.getPath(),a.currentPage=[0,0,0,0,0,0,0,0],a.pageSize=1,b.getBannedUsers().$loaded(function(b){a.bannedUsers=b}),a.title=b.getTitle(),a.users=b.getUsers()}function e(a,b){for(var c=[],d=[],e=0;e<b.getNumOfPara();e++)firebaseArray=b.getArrayofTranslations()[e],firebaseArray.$loaded().then(function(b){latestTranslation=b[b.length-1],d.push(latestTranslation.content.replace(/<br>/g,"\n").replace(/&nbsp/g," ")),a.content=d,c.push(b.length),a.theNumberOfEachTranslations=c}).catch(function(a){console.log(a.message)})}Date.prototype.yyyymmdd=function(){var a=this.getMonth()+1,b=this.getDate();return[this.getFullYear(),(a>9?"":"0")+a,(b>9?"":"0")+b].join("")};var a={apiKey:"AIzaSyDUid3Hb5DOI0gql4OoTaMloFLEoP10AV4",authDomain:"canadaforum-18020.firebaseapp.com",databaseURL:"https://canadaforum-18020.firebaseio.com",storageBucket:"canadaforum-18020.appspot.com",messagingSenderId:"496860594601"};firebase.initializeApp(a),angular.module("mainApp",["firebase","ngSanitize","ui.router"]).controller("MainController",c).filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).directive("dirNav",function(){var a={templateUrl:"template/dir-nav.html"};return a}).factory("ParasAndArrayOfTransFactory",["$firebaseObject","$firebaseArray",function(a,c){return function(d,e,f){return new b(a,c,d,e,f)}}]),c.$inject=["arrayOfPath","$window","$http","$firebaseAuth","ParasAndArrayOfTransFactory"]}();
